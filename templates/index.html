<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skills-Based Job Matcher</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 20px auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .course-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        
        .course-card:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }
        
        .course-card.selected {
            border-color: #4facfe;
            background-color: #f8f9ff;
        }
        
        .job-match-card {
            border-left: 4px solid #28a745;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            transition: transform 0.2s ease;
        }
        
        .job-match-card:hover {
            transform: translateY(-2px);
        }
        
        .match-score {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .skill-tag {
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 15px;
            padding: 0.2rem 0.6rem;
            font-size: 0.8rem;
            margin: 0.1rem;
            display: inline-block;
        }
        
        .skill-match {
            background: #e8f5e8;
            border-left: 3px solid #28a745;
            padding: 0.5rem;
            margin: 0.3rem 0;
            border-radius: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 0.7rem 2rem;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .system-status {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        
        .methodology-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [courses, setCourses] = useState([]);
            const [selectedCourses, setSelectedCourses] = useState([]);
            const [jobMatches, setJobMatches] = useState([]);
            const [loading, setLoading] = useState(false);
            const [systemStatus, setSystemStatus] = useState(null);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetchCourses();
                fetchSystemStatus();
            }, []);

            const fetchCourses = async () => {
                try {
                    const response = await fetch('/api/courses');
                    const data = await response.json();
                    if (data.success) {
                        setCourses(data.courses);
                    } else {
                        setError('Failed to load courses');
                    }
                } catch (err) {
                    setError('Error connecting to server');
                }
            };

            const fetchSystemStatus = async () => {
                try {
                    const response = await fetch('/api/system-status');
                    const data = await response.json();
                    if (data.success) {
                        setSystemStatus(data.status);
                    }
                } catch (err) {
                    console.log('Could not fetch system status');
                }
            };

            const toggleCourse = (courseCode) => {
                setSelectedCourses(prev => {
                    if (prev.includes(courseCode)) {
                        return prev.filter(c => c !== courseCode);
                    } else {
                        return [...prev, courseCode];
                    }
                });
            };

            const findMatchingJobs = async () => {
                if (selectedCourses.length === 0) {
                    setError('Please select at least one course');
                    return;
                }

                setLoading(true);
                setError(null);

                try {
                    const response = await fetch('/api/match-jobs', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            courses: selectedCourses,
                            top_k: 5
                        })
                    });

                    const data = await response.json();
                    if (data.success) {
                        setJobMatches(data.matches);
                    } else {
                        setError(data.error || 'Failed to find job matches');
                    }
                } catch (err) {
                    setError('Error connecting to server');
                } finally {
                    setLoading(false);
                }
            };

            const getStatusIndicator = (status) => {
                if (!status) return 'status-error';
                return status.is_trained ? 'status-active' : 'status-warning';
            };

            return (
                <div className="main-container">
                    {/* Header */}
                    <div className="header">
                        <h1><i className="fas fa-graduation-cap"></i> Skills-Based Job Matcher</h1>
                        <p className="mb-0">Discover career opportunities based on your academic skills</p>
                        <div className="methodology-info mt-3">
                            <small>
                                <i className="fas fa-info-circle"></i> Using hybrid semantic-ontological matching 
                                as recommended by 2024-2025 state-of-the-art research
                            </small>
                        </div>
                    </div>

                    <div className="container-fluid p-4">
                        {/* System Status */}
                        {systemStatus && (
                            <div className="system-status">
                                <h6><i className="fas fa-cogs"></i> System Status</h6>
                                <div className="row">
                                    <div className="col-md-3">
                                        <span className={`status-indicator ${getStatusIndicator(systemStatus)}`}></span>
                                        Matching Engine: {systemStatus.is_trained ? 'Ready' : 'Training'}
                                    </div>
                                    <div className="col-md-3">
                                        <i className="fas fa-graduation-cap text-primary"></i> {systemStatus.total_courses} Courses
                                    </div>
                                    <div className="col-md-3">
                                        <i className="fas fa-briefcase text-success"></i> {systemStatus.total_jobs} Jobs
                                    </div>
                                    <div className="col-md-3">
                                        <i className="fas fa-tags text-info"></i> {systemStatus.total_unique_skills} Skills
                                    </div>
                                </div>
                            </div>
                        )}

                        {error && (
                            <div className="alert alert-danger">
                                <i className="fas fa-exclamation-triangle"></i> {error}
                            </div>
                        )}

                        <div className="row">
                            {/* Course Selection */}
                            <div className="col-lg-6">
                                <h3><i className="fas fa-book"></i> Select Your Courses</h3>
                                <p className="text-muted">Choose the courses you have completed or are currently studying</p>
                                
                                <div className="selected-summary mb-3">
                                    <strong>Selected: {selectedCourses.length} course(s)</strong>
                                    {selectedCourses.length > 0 && (
                                        <button 
                                            className="btn btn-primary ms-3"
                                            onClick={findMatchingJobs}
                                            disabled={loading}
                                        >
                                            {loading ? (
                                                <>
                                                    <span className="spinner-border spinner-border-sm me-2"></span>
                                                    Finding Matches...
                                                </>
                                            ) : (
                                                <>
                                                    <i className="fas fa-search"></i> Find Matching Jobs
                                                </>
                                            )}
                                        </button>
                                    )}
                                </div>

                                <div style={{ maxHeight: '600px', overflowY: 'auto' }}>
                                    {courses.map(course => (
                                        <div 
                                            key={course.course_code}
                                            className={`course-card p-3 ${selectedCourses.includes(course.course_code) ? 'selected' : ''}`}
                                            onClick={() => toggleCourse(course.course_code)}
                                        >
                                            <div className="d-flex justify-content-between align-items-start">
                                                <div className="flex-grow-1">
                                                    <h6 className="mb-1">
                                                        <strong>{course.course_code}</strong>
                                                        {selectedCourses.includes(course.course_code) && (
                                                            <i className="fas fa-check-circle text-success ms-2"></i>
                                                        )}
                                                    </h6>
                                                    <p className="mb-1">{course.title}</p>
                                                    <small className="text-muted">{course.degree}</small>
                                                </div>
                                                <div className="text-end">
                                                    <span className="badge bg-info">{course.skill_count} skills</span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Job Matches */}
                            <div className="col-lg-6">
                                <h3><i className="fas fa-briefcase"></i> Matching Jobs</h3>
                                <p className="text-muted">Jobs that match your selected course skills</p>

                                {loading && (
                                    <div className="text-center">
                                        <div className="loading-spinner"></div>
                                        <p>Analyzing skills and finding matches...</p>
                                    </div>
                                )}

                                {jobMatches.length === 0 && !loading && (
                                    <div className="text-center text-muted p-5">
                                        <i className="fas fa-search fa-3x mb-3"></i>
                                        <p>Select courses and click "Find Matching Jobs" to see recommendations</p>
                                    </div>
                                )}

                                <div style={{ maxHeight: '600px', overflowY: 'auto' }}>
                                    {jobMatches.map((job, index) => (
                                        <div key={job.job_id} className="job-match-card p-3">
                                            <div className="d-flex justify-content-between align-items-start mb-2">
                                                <div className="flex-grow-1">
                                                    <h5 className="mb-1">{job.title}</h5>
                                                    <p className="text-muted mb-1">{job.industry}</p>
                                                </div>
                                                <div className="text-end">
                                                    <div className="match-score mb-1">
                                                        {(job.score * 100).toFixed(1)}% Match
                                                    </div>
                                                    <small className="text-muted">
                                                        {job.matched_count}/{job.total_job_skills} skills
                                                    </small>
                                                </div>
                                            </div>

                                            <p className="small text-muted mb-2">{job.description}</p>

                                            <div className="mb-2">
                                                <strong className="small">Matched Skills:</strong>
                                                <div className="mt-1">
                                                    {job.matched_skills.slice(0, 5).map((match, idx) => (
                                                        <div key={idx} className="skill-match small">
                                                            <strong>{match.job_skill}</strong>
                                                            {match.job_skill !== match.student_skill && (
                                                                <span className="text-muted">
                                                                    {' â†” ' + match.student_skill}
                                                                </span>
                                                            )}
                                                            <span className="badge bg-secondary ms-2">
                                                                {(match.score * 100).toFixed(0)}%
                                                            </span>
                                                        </div>
                                                    ))}
                                                    {job.matched_skills.length > 5 && (
                                                        <small className="text-muted">
                                                            +{job.matched_skills.length - 5} more skills...
                                                        </small>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="d-flex justify-content-between align-items-center">
                                                <small className="text-muted">
                                                    Job ID: {job.job_id}
                                                </small>
                                                <small className="text-success">
                                                    <i className="fas fa-chart-line"></i> Rank #{index + 1}
                                                </small>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-4 pt-3 border-top">
                            <small className="text-muted">
                                <i className="fas fa-robot"></i> Powered by hybrid semantic-ontological skill matching 
                                | <i className="fas fa-brain"></i> AI-driven career recommendations
                            </small>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
